---
title: "NZ_Homework1"
author: "Nicolas Zapata"
date: "2025-10-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir="~/projects/eco_genomics_2025/population_genomics/myresults/ANGSD/PCA_ADMIX/")
```


```{r}
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(qqman)
```


```{r}
allRScov2 <- as.matrix(read.table("allRS_poly_K2.cov"))

allRSPCA2 <- eigen(allRScov2)

varK2 <- round(allRSPCA2$values/sum(allRSPCA2$values),3)

varK2[1:3]

# A "screeplot" of the eigenvalues of the PCA:

barplot(varK2, 
        xlab="Eigenvalues of the PCA K=2", 
        ylab="Proportion of variance explained")
```

```{r}
allRScov3 <- as.matrix(read.table("allRS_poly_K3.cov"))

allRSPCA3 <- eigen(allRScov3)

varK3 <- round(allRSPCA3$values/sum(allRSPCA3$values),4)

varK3[1:4]

# A "screeplot" of the eigenvalues of the PCA:

barplot(varK3, 
        xlab="Eigenvalues of the PCA K=3", 
        ylab="Proportion of variance explained")
```

```{r}
allRScov4 <- as.matrix(read.table("allRS_poly_K4.cov"))

allRSPCA4 <- eigen(allRScov4)

varK4 <- round(allRSPCA4$values/sum(allRSPCA4$values),5)

varK4[1:5]

# A "screeplot" of the eigenvalues of the PCA:

barplot(varK4, 
        xlab="Eigenvalues of the PCA K=4", 
        ylab="Proportion of variance explained")
```

```{r}
allRScov5 <- as.matrix(read.table("allRS_poly_K5.cov"))

allRSPCA5 <- eigen(allRScov5)

varK5 <- round(allRSPCA5$values/sum(allRSPCA5$values),6)

varK5[1:6]

# A "screeplot" of the eigenvalues of the PCA:

barplot(varK5, 
        xlab="Eigenvalues of the PCA K=5", 
        ylab="Proportion of variance explained")
```

```{r}
names <- read.table("RSBS_bam.list")
names <- unlist(strsplit(basename(as.character(names[,1])), split = ".sorted.rmdup.bam"))
split = strsplit(names, "_")
pops <- data.frame(names[1:95], do.call(rbind, split[1:95]))
names(pops) = c("Ind", "Pop", "Row", "Col")
```

```{r}
data = as.data.frame(allRSPCA2$vectors)
data = data[,c(1:3)]
data = cbind(data,pops)

# PCA with just red spruce (95 samples):

ggscatter(data, x = "V1", y = "V2",
          color = "Pop",
          mean.point = TRUE,
          star.plot = TRUE,
          main="Red spruce genetic PCA") +
  theme_bw(base_size = 13, base_family = "Times") +
  labs(x = paste0("PC1: (",varK2[1]*100,"%)"), y = paste0("PC2: (",varK2[2]*100,"%)"))

```

```{r}
data = as.data.frame(allRSPCA3$vectors)
data = data[,c(1:3)]
data = cbind(data,pops)

# PCA with just red spruce (95 samples):

ggscatter(data, x = "V1", y = "V2",
          color = "Pop",
          mean.point = TRUE,
          star.plot = TRUE,
          main="Red spruce genetic PCA") +
  theme_bw(base_size = 13, base_family = "Times") +
  labs(x = paste0("PC1: (",varK3[1]*100,"%)"), y = paste0("PC2: (",varK3[2]*100,"%)"))

```
```{r}
data = as.data.frame(allRSPCA4$vectors)
data = data[,c(1:3)]
data = cbind(data,pops)

# PCA with just red spruce (95 samples):

ggscatter(data, x = "V1", y = "V2",
          color = "Pop",
          mean.point = TRUE,
          star.plot = TRUE,
          main="Red spruce genetic PCA") +
  theme_bw(base_size = 13, base_family = "Times") +
  labs(x = paste0("PC1: (",varK4[1]*100,"%)"), y = paste0("PC2: (",varK4[2]*100,"%)"))

```



```{r}
data = as.data.frame(allRSPCA5$vectors)
data = data[,c(1:3)]
data = cbind(data,pops)

# PCA with just red spruce (95 samples):

ggscatter(data, x = "V1", y = "V2",
          color = "Pop",
          mean.point = TRUE,
          star.plot = TRUE,
          main="Red spruce genetic PCA") +
  theme_bw(base_size = 13, base_family = "Times") +
  labs(x = paste0("PC1: (",varK5[1]*100,"%)"), y = paste0("PC2: (",varK5[2]*100,"%)"))

```









